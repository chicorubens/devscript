INFRA DE DOCKER

ğŸ“ ğ—™ğ—¼ğ—»ğ˜ğ—²ğ˜€ ğ—² ğ—Ÿğ—¶ğ—»ğ—¸ğ˜€:
â€£ DocumentaÃ§Ã£o sobre Docker: https://docs.docker.com/get-started/overview/
â€£ Essa Ã© a pÃ¡gina geral da documentaÃ§Ã£o: https://docs.docker.com/
â€£ https://www.youtube.com/watch?v=ntbpIfS44Gw
â€£ https://www.youtube.com/watch?v=RE31GWJGkwA

para instalaÃ§Ã£o do docker

~$ sudo apt install docker.io docker-compose
ou
vÃ¡ no documento oficial do docker: https://docs.docker.com/ sempre a melhor escolha por estÃ¡ atualizado

______________________________________________________________________________________

para iniciar junto com sistema e habilitar para o uso

~$ sudo systemctl enable --now docker docker.socket containerd

______________________________________________________________________________________

para ver menu de ajuda e comandos

docker --help

______________________________________________________________________________________

DOCKER HUB - RepositÃ³rio comunitÃ¡rio com imagens de aplicaÃ§Ãµes e sistemas operacionais
rodando em containers.

______________________________________________________________________________________

COLOCANDO USUÃRIO no grupo do Docker
*caso digite o comendo $ docker images e resultador for a informaÃ§Ã£oda nÃ£o permissÃ£o do usuÃ¡rio, faÃ§a o seguinte comando

$ cat /etc/group        //verÃ¡s grupos e usuÃ¡rios linux, inclusive o grupo docker
$ sudo usermod -a -G docker user        //usuÃ¡rio francisco por exemplo

______________________________________________________________________________________

CRIANDO AMBIENTE de desenvolvimento com wordpress: essa imagem serÃ¡ usada para todos servidores wordpress

$ sudo su 
# docker pull wordpress  //baixar a imagem
# docker images  //visualizar imagens baixadas, pode usar grep "docker images | grep nome_qualquer"
# docker run --name meu_wordpress -p 8080:80 -d wordpress    //criando container baseado na imagem e porta, servindo para acessar o "app", "-d Ã© para roda em segundo plano"
# docker run --name get-started --rm -p 9090:8080 tutorialcronapp/get_started:v0.01
# docker run --name <nome-container> --rm -p <porta>:8080
# docker run -it ubuntu                                     //criando container baseado na imagem e porta, servindo para acessar o "servidor"
# docker ps                                                 //lista os container rodando com seu id
# docker exec id ls /                                       //executa dentro do container especÃ­fco no caso lista as pastas ex: "docker exec 9ef7ec237f4b ls /"
# docker exec -it id bash                                   //executa basch dentro do container no meu terminal
# sail up -d    //para levantar container em serviÃ§o, o -d trabalha em modo invisivel
# sail down     //parar e limpar quando se usa o sail up -d

para limpar imagens do docker
# docker system prune -a
--------------------------------------------------------------------------
*obs para usar artisan no docker, em vez de usa "php artisan make:model Product" por exemplo
usa-se sail
# sail artisan make model Product
# sail composer require pacote | auto-load | ...
# sail yarn | npm | ... // sail yarn add ... | sail shell | sail root-shell| sail yarn install *para baixar as dependencias ja que nÃ£o se envia para o git (grande).
# sail thinker |mesmo: php artisan thinker

e para publicar as modificaÃ§Ãµes do sail
sail artisan sail:publish

sail build --no-chache  //para construir o app nas versÃµes atualizadas e depois sail up -d

sail share  //para usar na rede local para visualizar o projeto
______________________________________________________
*reiniciando um projeto aula 4.8 black dev
-clone repositorio
-abra documentaÃ§Ã£o  //*quando se tem composer apenas no container (https://laravel.com/docs/9.x/sail)
-va em Installing Composer Dependencies For Existing Applications (https://laravel.com/docs/9.x/sail#executing-composer-commands).
copie:
docker run --rm \
    -u "$(id -u):$(id -g)" \
    -v "$(pwd):/var/www/html" \
    -w /var/www/html \
    laravelsail/php81-composer:latest \ //atenÃ§Ã£o! a versÃ£o de imagem Ã© enxuta e serve para baixar dependÃªncias.
    composer install --ignore-platform-reqs

-verifique o .env e gere a chave sail artisan key:generate
-sail up -d 


_____________
    <nome-container>: defina um nome para o contÃªiner Docker.
    <porta>:8080: porta local para executar o projeto e a porta onde o Docker estÃ¡ rodando, o padrÃ£o Ã© "8080". Garanta que nÃ£o exista outro serviÃ§o sendo executado na primeira porta.
    No cÃ³digo exemplo abaixo, escolhemos a porta "9090" para o projeto e deixamos a porta padrÃ£o "8080" para o Docker.
    informe a sua conta DockerHub, ou outro registry Docker, informado no comando anterior.
    informe o repositÃ³rio da sua conta DockerHub, ou outro registry Docker,informado no comando anterior.
    informe a versÃ£o da imagem usado no comando anterior.
_____________
______________________________________________________________________________________

RODANDO uma aplicaÃ§Ã£o em um container precisamos crisar arquivo docker file ;-)

* Para isso veja no documento do endereÃ§o: https://docs.docker.com/engine/reference/builder/, onde encontrarÃ¡ conteÃºdo necessÃ¡rio,
siga a seguinte logica de tarefas

1 Âº Criar a image na qual tenha o servidor (por exemplo usando pyton, laravel, jango, spring...)
    -procure em dockerhub python clique e veja uma tag referente a versÃ£o e S.O certo para a aplicaÃ§Ã£o. FaÃ§a como na parte CRIANDO AMBIENTE.

2 Âº Criar arquivo Dockerfile na pasta da aplicaÃ§Ã£o e nele siga a sequÃªncia de comandos. 
(instalar dependÃªncias > copiar arquivo principal > expor porta 5000 > rodar aplicaÃ§Ã£o)
sequÃªncia....

FROM python:3.8.12-bullseye         //este comando indica a imagen e versÃ£o

WORKDIR /app                        //dentro da imagem o workdir vai mudar para essa pasta na imagem, se nÃ£o existe ele vai criar e transformara no diretÃ³rio atual representado no linux pelo ponto(.)
   
*no term crie arquivo requirements.txt e preencha com resultado do comando $ pip freeze ou $ pip freeze > requirements.txt

COPY requirements.txt .

RUN pip install -r requirements.txt //apontando arquivo para instalaÃ§Ã£o das bibliotecas

EXPOSE 5000                         //faz a aplicaÃ§Ã£o roda na porta 5000 que Ã© bom atÃ© para os desenvolvedores do sistema

ENV FLASK_ENV development           //cria variavel de ambiente

COPY app.py .                       //copia o app.py para diretÃ³rio atual usando o ponto

CMD ["flask", "run", "--host", "0.0.0.0"]    //executa o comando para rodar no IP da interface da aplicaÃ§Ã£o, para conseguir receber as requisiÃ§Ãµes.

*prontinho, depois de criado o arquivo vamos criar a nossa imagem

$ docker buid -t flask-app:dev-0.0.1 .      //com isso vai executar em uma determinada versÃ£o criada para fazer a orientaÃ§Ã£o da equipe e apontando o diretÃ³rio atual com o (.), caso use outro diretÃ³rio use o -f e caminho em vez de usar o ponto.
______________________________________________________________________________________

REMOVENDO CONTAINERS

1Âº precisamos listÃ¡-los e verificar seu estado ou status UP "rodando" ou EXITED (0) "existem mas estÃ£o parados".
2Âº precisamos PARAR serviÃ§o com comando
# docker stop 645b7a26db6f  //no qual o ID ou NOME serÃ¡ usado isso. lembrando que ainda existe start, restart e status
3Âº vamos entÃ£o para a remoÃ§Ã£o do container com comando
# docker rm 645b7a26db6f    //no qual o ID ou NOME serÃ¡ usado isso.
# docker rmi ubunto         //para remover a imagem

______________________________________________________________________________________

ESTUDO FUTURO DE DOCKER PARA ESPECIALIZAR

-> Overlay File System
______________________________________________________________________________________














